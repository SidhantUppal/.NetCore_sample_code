//------------------------------------------------------------------------------
// <autogenerated>
//     
//       Changes to this template will not be lost.
//
//     Template: EditableRootList.cst
//     
// </autogenerated>
//------------------------------------------------------------------------------
using Dapper;
using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;

namespace CFMData
{
    /// <summary>
    /// The BankAccountList class is a CSLA editable root list class collection of <see cref="BankAccount"/> objects.  See CSLA documentation for a more detailed description.
    /// </summary>
    /// <returns></returns>
    public partial class BankAccountList
    {
        public static BankAccountList ValidateBankAccount(int bsbDetailID, string accountNumber, int? bankAccountID)
        {
            return new BankAccountList().DataPortal_Fetch(bsbDetailID, accountNumber, bankAccountID);
        }

        private BankAccountList DataPortal_Fetch(int bsbDetailID, string accountNumber, int? bankAccountID)
        {
            bool cancel = false;

            if (cancel) return null;

            // Fetch Child objects.
            using (var connection = new SqlConnection(ADOHelper.ConnectionString))
            {
                connection.Open();
                using (var command = new SqlCommand("[dbo].[spCFM_BankAccount_Validate]", connection))
                {
                    command.CommandType = CommandType.StoredProcedure;

                    command.Parameters.AddWithValue("@p_BSBDetailID", bsbDetailID);
                    command.Parameters.AddWithValue("@p_AccountNumber", accountNumber);

                    if (bankAccountID.HasValue)
                    {
                        command.Parameters.AddWithValue("@p_BankAccountID", bankAccountID.Value);
                    }

                    using (var reader = command.ExecuteReader())
                    {

                        if (reader.Read())
                        {
                            var rowParser = reader.GetRowParser<BankAccount>();
                            do
                            {

                                this.Add(BankAccount.GetBankAccount(rowParser, reader));
                            } while (reader.Read());
                        }
                        return this;
                    }
                }
            }
        }
    }
}